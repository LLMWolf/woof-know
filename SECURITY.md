# SECURITY.md — СПРИ

Этот документ описывает базовые практики безопасности для проекта СПРИ (MVP R0.1–R0.3).

## Контакты

* Security/Ops: [security@example.local](mailto:security@example.local)

## Политики

* **Приватность по умолчанию:** `strict_local`. Внешние HTTP‑вызовы запрещены, если не включён профиль `hybrid`/`cloud_ok`.
* **Kill‑switch:** глобальный переключатель блокирует любые внешние обращения вне локального контура. Смена состояния журналируется.
* **Аутентификация:** Bearer JWT (по умолчанию) или OIDC (при включении). Токены — с TTL, хранить только хеш/отпечатки при необходимости аудита.
* **Авторизация:** RBAC (`admin`, `user`, `viewer`).
* **Шифрование:** TLS≥1.2 для периметра; шифрование диска/томов рекомендовано.
* **Логирование:** без PII; ретенция 90 дней. В логи не попадают содержимое документов и промпты целиком — только технические метрики/идентификаторы.
* **Уязвимости:** используйте GitHub Security Advisories/Dependabot. Ответ целевой — в течение 7 дней.

## Процесс репортинга уязвимостей

1. Не создавайте публичные issues. Отправьте письмо на [security@example.local](mailto:security@example.local) с темой `SECURITY: <кратко>` и шагами воспроизведения.
2. Вы получите подтверждение в течение 48 часов.
3. Патч выпускается в приватной ветке; после релиза публикуется CVE/адвайзори.

## STRIDE (минимум)

* **S (Spoofing):** bearer/OIDC, уникальные учётные записи, MFA (если доступно).
* **T (Tampering):** контроль целостности `settings.json` (хеш/подпись), read‑only монтирование конфигов, миграции через PR.
* **R (Repudiation):** корреляционные `traceId`, audit‑лог админ‑действий, неизменяемые журналы (WORM‑стратегия при необходимости).
* **I (Information Disclosure):** профили приватности, kill‑switch, маскирование данных в логах, минимизация объёма логов.
* **D (Denial of Service):** rate‑limit (100 req/min), экспоненциальный backoff, ограничения размеров/страниц ingest.
* **E (Elevation of Privilege):** RBAC на уровне API, принципы наименьших привилегий, ревью прав в релизах.

## Secure Coding

* Валидация входа по JSON Schema (draft 2020‑12).
* Экранирование/нормализация текстов из документов (убирать управляющие последовательности).
* Ограничение длины промптов и размеров чанков.
* Минимизировать доступ к ФС; использовать относительные песочницы.

## Поставки и зависимости

* SBOM (CycloneDX) обязателен для релизов `v>=0.1.0`.
* Лицензии зависимостей проверяются на этапе CI.
* Обновления безопасности — минимум ежемесячно.

## Инциденты

* RPO ≤ 1 час, RTO ≤ 4 часа.
* Ежедневные бэкапы SQLite, квартальные тесты восстановления.
